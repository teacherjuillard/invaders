<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Invader Grid</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            display: flex;
            flex-direction: row;
            gap: 40px;
        }
        #main {
            flex: 2;
        }
        #reference {
            flex: 1;
        }
        #grid {
            display: grid;
            grid-template-columns: repeat(16, 30px);
            grid-template-rows: repeat(8, 30px);
            gap: 2px;
            margin-bottom: 20px;
        }
        .cell {
            width: 30px;
            height: 30px;
            background-color: white;
            border: 1px solid #ccc;
            cursor: pointer;
        }
        .cell.active {
            background-color: black;
        }
        #mission {
            margin-bottom: 20px;
            font-family: monospace;
        }
        #pokedex {
            margin-top: 30px;
        }
        .invader {
            display: inline-block;
            margin: 10px;
            text-align: center;
        }
        .mini-grid {
            display: grid;
            grid-template-columns: repeat(16, 5px);
            grid-template-rows: repeat(8, 5px);
            gap: 1px;
            margin-bottom: 5px;
        }
        .mini-cell {
            width: 5px;
            height: 5px;
            background-color: white;
        }
        .mini-cell.active {
            background-color: black;
        }
        table {
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 4px 8px;
            text-align: center;
        }
    </style>
</head>
<body>
<div id="main">
    <h1>Invader Grid</h1>
    <div id="grid"></div>
    <button onclick="checkMatch()">Vérifier</button>
    <button onclick="clearGrid()">Effacer tout</button>
    <button onclick="showCurrentCode()">Montrer le code actuel</button>
    <div id="result"></div>
    <div id="current-code" style="margin-top:10px; font-family: monospace;"></div>
</div>
<script>
    const invaders = [
        {
            name: "Invader Vide",
            hexCode: Array(8).fill("00"),
            unlocked: false
        },
        {
            name: "Invader Plein",
            hexCode: Array(8).fill("FF"),
            unlocked: false
        },
        {
            name: "Invader Croix",
            hexCode: Array(8).fill("81"),
            unlocked: false
        }
        // Ajouter d'autres invaders 8x8 ici
    ];

    const grid = document.getElementById('grid');
    let currentTarget = 0;

    // Création d'une grille 8x8
    grid.style.gridTemplateColumns = "repeat(8, 30px)";
    grid.style.gridTemplateRows = "repeat(8, 30px)";
    for (let r = 0; r < 8; r++) {
        for (let c = 0; c < 8; c++) {
            const cell = document.createElement('div');
            cell.classList.add('cell');
            cell.dataset.row = r;
            cell.dataset.col = c;
            cell.addEventListener('click', () => cell.classList.toggle('active'));
            grid.appendChild(cell);
        }
    }

    // --- Gestion du paramètre URL (compact : 32 caractères hexadécimaux) ---
    function getUrlParams() {
        const params = new URLSearchParams(window.location.search);
        return params.get('code');
    }

    let customCode = getUrlParams(); 
    if (customCode) { 
        let cleaned = customCode.toUpperCase().replace(/[^0-9A-F]/g, ""); // sécurité 
        if (cleaned.length === 16) { 
            let customHex = []; 
            for (let i = 0; i < 16; i += 2) { 
                customHex.push(cleaned.substring(i, i + 2)); 
            } 
            invaders.splice(0, invaders.length, { name: "Invader personnalisé", hexCode: customHex, unlocked: false }); 
        } else { 
            alert("⚠️ Le code fourni n'est pas valide : il faut exactement 16 caractères hexadécimaux."); 
        } 
    }

    function getGridHex8x8() {
    let hexRows = [];
    for (let r = 0; r < 8; r++) {
        let bin = '';
        for (let c = 0; c < 8; c++) {
            const cell = document.querySelector(`.cell[data-row='${r}'][data-col='${c}']`);
            // Le bit de gauche (c=0) devient MSB
            bin += cell.classList.contains('active') ? '1' : '0';
        }
        hexRows.push(parseInt(bin, 2).toString(16).padStart(2, '0').toUpperCase());
    }
    return hexRows;
}


    function checkMatch() {
        const currentHex = getGridHex8x8();
        const targetHex = invaders[currentTarget].hexCode;
        if (JSON.stringify(currentHex) === JSON.stringify(targetHex)) {
            result.textContent = "✔️ Bravo !";
            invaders[currentTarget].unlocked = true;
        } else {
            result.textContent = "❌ Ce n'est pas le bon invader.";
        }
    }

    function clearGrid() {
        document.querySelectorAll('.cell').forEach(cell => cell.classList.remove('active'));
    }

    function showCurrentCode() {
        const currentHex = getGridHex8x8();
        document.getElementById('current-code').textContent = "Code actuel : " + currentHex.join('');
    }
</script>
</body>
</html>
